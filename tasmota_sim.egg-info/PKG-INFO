Metadata-Version: 2.4
Name: tasmota-sim
Version: 1.0.0
Summary: A comprehensive Tasmota smart device simulator with RabbitMQ messaging
Home-page: https://github.com/your-repo/tasmota-sim
Author: Tasmota Simulator
Author-email: 
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: aio-pika>=9.4.0
Requires-Dist: click>=8.1.7
Requires-Dist: pydantic>=2.5.0
Requires-Dist: fastapi>=0.104.1
Requires-Dist: uvicorn>=0.24.0
Requires-Dist: asyncio-mqtt>=0.13.0
Requires-Dist: aiohttp>=3.9.0
Requires-Dist: python-dotenv>=1.0.0
Requires-Dist: colorama>=0.4.6
Requires-Dist: rich>=13.7.0
Requires-Dist: pyyaml>=6.0.1
Requires-Dist: setuptools>=69.0.3
Dynamic: author
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# Tasmota Smart Plug Simulator

Ein umfassendes Simulationssystem f√ºr Tasmota Smart Plugs mit RabbitMQ-Messaging, Web-Server und Docker-Hosting.

## üöÄ Schnellstart

### Option 1: Web-Server + Direkte IP-Steuerung (Neu & Empfohlen)

**Schritt 1: Devices erstellen & IP-Aliase einrichten**
```bash
# CLI installieren (falls noch nicht geschehen)
pip install -e .

# Devices erstellen mit automatischen IP-Aliases
tasmota-sim create-devices --count 3 --setup-ip-aliases
```

**Schritt 2: Container starten**
```bash
# Alle Services inkl. Web-Server starten
docker-compose up -d
```

**Schritt 3: Devices testen**
```bash
# √úber direkte IP-Adressen (wie echte Tasmota-Devices!)
curl http://172.25.0.100  # Device 1 Status
curl http://172.25.0.101  # Device 2 Status  
curl http://172.25.0.102  # Device 3 Status

# Oder √ºber localhost-Ports
curl http://localhost:8081  # Device 1
curl http://localhost:8082  # Device 2
curl http://localhost:8083  # Device 3

# Tasmota-Commands senden
curl -u admin:test1234! "http://172.25.0.100/cm?cmnd=Power%20ON"
curl -u admin:test1234! "http://172.25.0.101/cm?cmnd=Power%20OFF"
curl -u admin:test1234! "http://172.25.0.102/cm?cmnd=Power%20TOGGLE"
```

**Schritt 4: Web-Interface nutzen**
```bash
# FastAPI Swagger-Dokumentation
open http://localhost:8081/docs  # Device 1 API-Docs
open http://localhost:8082/docs  # Device 2 API-Docs
open http://localhost:8083/docs  # Device 3 API-Docs

# Oder direkt √ºber IP
open http://172.25.0.100/docs
```

### Option 2: Lokale CLI + Docker Services

**Schritt 1: Lokale CLI Installation**
```bash
# Windows
install-local.bat

# Linux/macOS
./install-local.sh

# Oder manuell
pip install -e .
```

**Schritt 2: Docker Services starten**
```bash
# Nur RabbitMQ und Device-Container (ohne CLI-Container)
docker-compose -f docker-compose.services.yml up -d
docker-compose -f docker-compose.override.yml up -d
```

**Schritt 3: CLI lokal verwenden**
```bash
# Hilfe anzeigen
tasmota-sim --help

# Ger√§te erstellen
tasmota-sim create-devices --count 5

# Ger√§testatus abfragen
tasmota-sim status kitchen_001

# Ger√§t ein-/ausschalten
tasmota-sim power kitchen_001 on
tasmota-sim power kitchen_001 off

# Energiedaten abfragen
tasmota-sim energy kitchen_001
```

## üåê Web-Server Features

### üéØ Verf√ºgbare Endpunkte

| Endpunkt | Beschreibung | Authentifizierung |
|----------|--------------|-------------------|
| `GET /` | Device-Status und Infos | Keine |
| `GET /cm?cmnd=<command>` | Tasmota-Commands | Basic Auth |
| `GET /docs` | FastAPI Swagger-UI | Keine |
| `GET /openapi.json` | OpenAPI-Schema | Keine |

### üîê Authentifizierung

**Standard-Zugangsdaten:**
- **Benutzer**: `admin`
- **Passwort**: `test1234!`

**Beispiele:**
```bash
# Ohne Auth - Status abfragen
curl http://172.25.0.100

# Mit Auth - Commands senden
curl -u admin:test1234! "http://172.25.0.100/cm?cmnd=Power%20ON"
curl -u admin:test1234! "http://172.25.0.100/cm?cmnd=Power%20OFF"
curl -u admin:test1234! "http://172.25.0.100/cm?cmnd=Power%20TOGGLE"
```

### üè† Device-Zugriff

**Drei Zugriffsmethoden verf√ºgbar:**

1. **Direkte IP-Adressen** (Realistisch, wie echte Tasmota-Devices):
   - `http://172.25.0.100` ‚Üí kitchen_001
   - `http://172.25.0.101` ‚Üí kitchen_002  
   - `http://172.25.0.102` ‚Üí kitchen_003

2. **Localhost-Ports** (Entwicklerfreundlich):
   - `http://localhost:8081` ‚Üí kitchen_001
   - `http://localhost:8082` ‚Üí kitchen_002
   - `http://localhost:8083` ‚Üí kitchen_003

3. **Container-zu-Container** (Automatisch im Docker-Netzwerk)

## üèóÔ∏è Architektur

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Web Browser   ‚îÇ    ‚îÇ   RabbitMQ      ‚îÇ    ‚îÇ Device Container‚îÇ
‚îÇ   HTTP Client   ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Docker)      ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ + Web Server    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                        ‚îÇ                        ‚îÇ
        ‚îÇ                        ‚îÇ                        ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇFastAPI  ‚îÇ              ‚îÇMessage  ‚îÇ              ‚îÇTelemetry‚îÇ
   ‚îÇCommands ‚îÇ              ‚îÇ Broker  ‚îÇ              ‚îÇStatus   ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Lokale CLI    ‚îÇ    ‚îÇ   Setup Scripts ‚îÇ
‚îÇ   (Optional)    ‚îÇ    ‚îÇ   IP-Aliase     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìã Verf√ºgbare CLI-Befehle

| Befehl | Beschreibung | Beispiel |
|--------|--------------|----------|
| `create-devices` | Erstellt Device-Container (mit IP-Alias Option) | `tasmota-sim create-devices --count 3 --setup-ip-aliases` |
| `setup-ip-aliases` | Erstellt IP-Aliase f√ºr direkten Zugriff | `tasmota-sim setup-ip-aliases --count 3` |
| `remove-ip-aliases` | Entfernt IP-Aliase | `tasmota-sim remove-ip-aliases --count 3` |
| `status` | Fragt Ger√§testatus ab | `tasmota-sim status kitchen_001` |
| `power` | Schaltet Ger√§t ein/aus | `tasmota-sim power kitchen_001 on` |
| `energy` | Fragt Energiedaten ab | `tasmota-sim energy kitchen_001` |
| `monitor` | Echzeit-Monitoring* | `tasmota-sim monitor` |
| `docker-up` | Startet Docker Services | `tasmota-sim docker-up` |
| `docker-down` | Stoppt Docker Services | `tasmota-sim docker-down` |
| `docker-restart` | Startet Services neu | `tasmota-sim docker-restart --all` |
| `docker-logs` | Zeigt Service-Logs | `tasmota-sim docker-logs rabbitmq -f` |
| `docker-clean` | Bereinigt Docker-Ressourcen | `tasmota-sim docker-clean` |
| `docker-status` | Zeigt Container-Status | `tasmota-sim docker-status` |
| `list-devices` | Listet Device-Container | `tasmota-sim list-devices --status` |

*Monitoring-Feature wird noch implementiert

## üîß Setup & Konfiguration

### IP-Aliase Setup (F√ºr direkte IP-Zugriffe)

```bash
# IP-Aliase erstellen (einmalig pro Shell-Session)
./setup-ip-aliases.sh

# IP-Aliase entfernen (optional)
./remove-ip-aliases.sh
```

### Umgebungsvariablen

```bash
# Lokale CLI-Nutzung (Standard)
export RABBITMQ_HOST=localhost
export RABBITMQ_USER=admin
export RABBITMQ_PASS=admin123

# Docker-interne Nutzung
export RABBITMQ_HOST=172.25.0.10
export RABBITMQ_USER=admin
export RABBITMQ_PASS=admin123

# Web-Server Konfiguration
export DEFAULT_USERNAME=admin
export DEFAULT_PASSWORD=test1234!
```

### RabbitMQ Management UI

- **URL**: http://localhost:15672
- **Benutzer**: admin
- **Passwort**: admin123

## üåê Netzwerk-Konfiguration

### Standard-Konfiguration
- **RabbitMQ**: `172.25.0.10:5672` (intern), `localhost:5672` (extern)
- **Device IPs**: `172.25.0.100`, `172.25.0.101`, `172.25.0.102`
- **Web-Server Ports**: `8081`, `8082`, `8083` (extern)
- **Subnet**: `172.25.0.0/16`

### Port-Mapping
| Container | Interne IP | Externe Ports | Web-Interface |
|-----------|------------|---------------|---------------|
| kitchen_001 | 172.25.0.100 | 8081‚Üí80 | http://localhost:8081 |
| kitchen_002 | 172.25.0.101 | 8082‚Üí80 | http://localhost:8082 |
| kitchen_003 | 172.25.0.102 | 8083‚Üí80 | http://localhost:8083 |
| rabbitmq | 172.25.0.10 | 5672, 15672 | http://localhost:15672 |

## üí° Nutzungsbeispiele

### Web-Server Setup

```bash
# 1. IP-Aliase einrichten
./setup-ip-aliases.sh

# 2. Container starten
docker-compose up -d

# 3. Devices √ºber Web-Interface testen
curl http://172.25.0.100
curl http://172.25.0.101  
curl http://172.25.0.102

# 4. Tasmota-Commands senden
curl -u admin:test1234! "http://172.25.0.100/cm?cmnd=Power%20ON"
curl -u admin:test1234! "http://172.25.0.101/cm?cmnd=Power%20OFF"

# 5. API-Dokumentation √∂ffnen
open http://172.25.0.100/docs
```

### CLI-basierte Nutzung

```bash
# 1. CLI installieren
pip install -e .

# 2. Ger√§te erstellen (mit automatischen IP-Aliases)
tasmota-sim create-devices --count 3 --setup-ip-aliases

# 3. Services starten
docker-compose up -d

# 4. Ger√§te testen
tasmota-sim status kitchen_001

# Oder IP-Aliases manuell verwalten:
tasmota-sim setup-ip-aliases --count 3     # Erstellen
tasmota-sim remove-ip-aliases --count 3    # Entfernen
```

### Erweiterte Web-Server-Nutzung

```bash
# Alle Devices gleichzeitig steuern
for ip in 172.25.0.100 172.25.0.101 172.25.0.102; do
    curl -u admin:test1234! "http://$ip/cm?cmnd=Power%20ON"
done

# Status aller Devices abfragen
for ip in 172.25.0.100 172.25.0.101 172.25.0.102; do
    echo "Device $ip:"
    curl http://$ip | jq
done

# Container-Management
docker-compose logs -f tasmota-device-1  # Logs verfolgen
docker-compose restart tasmota-device-2  # Einzelnen Container neu starten
docker-compose down && docker-compose up -d  # Alle Container neu starten
```

## üìä Features

### ‚úÖ Implementiert
- **üåê FastAPI Web-Server** mit Swagger-UI f√ºr jedes Device
- **üè† Direkte IP-Steuerung** wie echte Tasmota-Devices
- **üîê HTTP Basic Authentication** f√ºr Tasmota-Commands
- **üì° Realistische Device-Simulation** (15-85W Verbrauch)
- **üê∞ RabbitMQ Topic-Messaging** mit persistenten Nachrichten
- **üñ•Ô∏è Individuelle Container-IPs** f√ºr jedes Ger√§t
- **‚ö° Asynchrone aio-pika & uvicorn** f√ºr hohe Performance
- **üîß Setup-Scripts** f√ºr automatische IP-Alias-Konfiguration
- **üìä Health Checks** f√ºr RabbitMQ und Web-Server

### üîÑ In Entwicklung
- **üìà Echzeit-Monitoring Dashboard** mit Rich-UI
- **üéõÔ∏è Web-basiertes Dashboard** f√ºr Device-Management
- **üå°Ô∏è Erweiterte Telemetrie** (Temperatur, Feuchtigkeit)
- **üë• Device-Gruppen** und Szenarien
- **üîÑ WebSocket-Support** f√ºr Realtime-Updates

## üêõ Troubleshooting

### H√§ufige Probleme

**Web-Server nicht erreichbar**
```bash
# Container-Status pr√ºfen
docker-compose ps

# Logs anzeigen
docker-compose logs tasmota-device-1

# IP-Aliase pr√ºfen
ifconfig lo0 | grep 172.25
```

**"Can't assign requested address" Fehler**
```bash
# IP-Aliase m√ºssen vor Container-Start erstellt werden
docker-compose down
./setup-ip-aliases.sh
docker-compose up -d
```

**Authentifizierung fehlschl√§gt**
```bash
# Korrekte Zugangsdaten verwenden
curl -u admin:test1234! "http://172.25.0.100/cm?cmnd=Power%20ON"

# Base64-Encoding manuell (alternativ)
echo -n "admin:test1234!" | base64
curl -H "Authorization: Basic YWRtaW46dGVzdDEyMzQh" "http://172.25.0.100/cm?cmnd=Power%20ON"
```

**CLI-Befehle funktionieren nicht**
```bash
# Pr√ºfen ob CLI installiert ist
tasmota-sim --help

# Falls nicht, neu installieren
pip install -e .
```

**Verbindung zu RabbitMQ fehlschl√§gt**
```bash
# RabbitMQ Status pr√ºfen
docker-compose ps rabbitmq

# RabbitMQ neu starten
docker-compose restart rabbitmq
```

**IP-Aliase funktionieren nicht**
```bash
# Aliase pr√ºfen
ifconfig lo0 | grep 172.25

# Aliase neu erstellen
./remove-ip-aliases.sh
./setup-ip-aliases.sh

# macOS: Manchmal Neustart erforderlich
sudo dscacheutil -flushcache
```

## üì¶ Installation Details

### Voraussetzungen
- **Python 3.8+**
- **Docker & Docker Compose**
- **Git** (f√ºr Entwicklung)
- **Admin-Rechte** (f√ºr IP-Alias-Setup)

### Abh√§ngigkeiten
- `fastapi>=0.104.0` - Web-Framework
- `uvicorn>=0.24.0` - ASGI Server
- `aio-pika>=9.4.0` - Asynchrones RabbitMQ
- `click>=8.1.7` - CLI Framework
- `pydantic>=2.5.0` - Datenvalidierung
- `rich>=13.7.0` - Terminal-UI
- `pyyaml>=6.0.1` - YAML-Konfiguration

### Setup-Scripts
- `setup-ip-aliases.sh` - Erstellt IP-Aliase f√ºr direkte Device-Zugriffe
- `remove-ip-aliases.sh` - Entfernt IP-Aliase
- `install-local.sh` / `install-local.bat` - CLI-Installation

## üîó Verweise

- **RabbitMQ Dokumentation**: https://www.rabbitmq.com/documentation.html
- **Tasmota Projekt**: https://tasmota.github.io/docs/
- **FastAPI Dokumentation**: https://fastapi.tiangolo.com/
- **Docker Compose**: https://docs.docker.com/compose/

---

**üí° Tipp**: Nutzen Sie die Web-Server-Funktionalit√§t f√ºr realistische Tasmota-Device-Simulation oder die lokale CLI f√ºr Bulk-Operationen und Entwicklung! 
